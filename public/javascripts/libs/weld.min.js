/*!
 * Weld - A Widget Framework
 */(function(a,b){var c={};(function(a){a.App=function(c){function n(a){return j[a]||null}function o(a){return k[a]||null}c=c||{};var d=a.App,e=new a.Messenger,f=c.defaultServices||[],g=new a.ServiceProvider(c.services||{}),h=0,i=c.prefix||"weld-module-",j={},k={},l=d.WidgetNotFoundError,m=d.RequiredCreatorMethodError;return e.register=function(a,b){return k[a.name]=a,{create:function(b){return e.create(a.name,b)}}},e.unregister=function(a){delete k[a.name||a]},e.create=function(a,b){var c,d,e,k=o(a);if(k===null)throw new l(a);return d=i+h++,e=g(k.options.services||f),j[d]={creator:k.creator,instance:null,middleware:k.options.middleware||null,options:b,services:e},d},e.start=function(c){var d=n(c),f={},h;if(d!==null&&d.instance===null){f.app=e,f.options=d.options,f.services=d.services,h=new a.Sandbox(c,f);if(d.middleware)for(var i=0,j=d.middleware.length;i<j;i++)d.middleware[i](h,g);d.instance=d.creator(h);if(d.instance.create===b)throw new m("create");return d.instance.create(),c}return null},e.stop=function(a){var c=n(a);if(c!==null&&c.instance!==null){if(c.instance.destroy===b)throw new m("destroy");return c.instance.destroy(),c.instance=null,a}return null},e.addService=function(a,b){g(a,b)},e.removeService=function(a){g(a,b)},e},a.App.WidgetNotFoundError=function(a){this.name="WidgetNotFoundError",this.message="Widget "+(a?""+a+" ":"")+"doesn't exist"},a.App.RequiredCreatorMethodError=function(){this.name="RequiredCreatorMethodError",this.message='Widgets creator functions are required to return both a "create" and "destroy" function.'},a.App.WidgetNotFoundError.prototype=new Error,a.App.RequiredCreatorMethodError.prototype=new Error})(c),function(a){a.Messenger=function(){var a=this,c={},d,e,f,g,h,i;a.publish=function(a,b,d){var e,f;if(c[a]){thisMessage=b||[],f=c[a];for(var g=0,h=f.length;g<h;g++)f[g].call(d||null,thisMessage)}},a.publishMany=function(b,c,d){for(var e=0,f=b.length;e<f;e++)a.publish(b[e],c,d)},a.subscribe=function(a,d){return c[a]===b&&(c[a]=[]),c[a].push(d),{channel:a,callback:d}},a.subscribeMany=function(b,c){var d=[];for(var e=0,f=b.length;e<f;e++)d.push(a.subscribe(b[e],c));return d},a.unsubscribe=function(a){var b=a.channel;if(b&&c[b]){var d=c[b];for(var e=0,f=d.length;e<f;e++)d[e]===a.callback&&d.splice(e,1)}},a.unsubscribeMany=function(b){for(var c=0,d=b.length;c<d;c++)a.unsubscribe(b[c])}},a.Messenger.Scoped=function(b,c){var d=a.Messenger,e=this,f=[],g,h,i,j;c||(c=new d),e.publish=function(a,d,e){c.publish(b+a,d,e)},e.subscribe=function(a,d){var e=c.subscribe(b+a,d);return f.push(e),e},e.unsubscribe=function(a){c.unsubscribe(a)},e.unsubscribeAll=function(){c.unsubscribeMany(f)}}}(c),function(a){a.Sandbox=function(b,c){c=c||{};var d=new a.Messenger.Scoped("/"+b+"/",c.app||null);return options=c.options||{},services=c.services||{},d.getId=function(){return b},d.getOption=function(a){return options[a]},d.getService=function(a){return services[a]},d}}(c),function(a){a.ServiceProvider=function(a){var c={},d=function(a,e){var f=null;if(e!==b)f=c[a]=e;else{if(Object.prototype.toString.call(a)==="[object String]")return c[a];if(Object.prototype.toString.call(a)==="[object Array]"){f={};for(var g=0,h=a.length;g<h;g++)f[a[g]]=d(a[g])}}return f};for(var e in a)a.hasOwnProperty(e)&&d(e,a[e]);return d}}(c),function(a){a.Widget=function(a,c,d){this.name=a,d===b?(this.creator=c,this.options={}):(this.options=c,this.creator=d)}}(c),a.Weld=c})(this);