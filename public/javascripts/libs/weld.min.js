/*!
 * Weld - A Widget Framework
 */(function(a,b){var c={};(function(a){a.App=function(c){function m(){var a=c.middleware;if(a!==b)for(var d=0,e=a.length;d<e;d++)q(a[d].name,a[d])}function n(a){return i[a]||null}function o(a){return j[a]||null}function p(a,c){if(a!==b&&c!==b){var d=a.concat(c);for(var e=0;e<d.length;e++)for(var f=e+1;f<d.length;f++)d[e]===d[f]&&d.splice(f,1);return d}return a||c}c=c||{};var d=a.App,e=new a.Messenger,f=c.defaultServices||[],g=0,h=c.prefix||"weld-module-",i={},j={},k=d.WidgetNotFoundError,l=d.RequiredCreatorMethodError,q=new a.SimpleCache,r=new a.SimpleCache(c.services||{});return e.register=function(a){j[a.name]=a},e.unregister=function(a){delete j[a.name||a]},e.create=function(a,b){var c,d,e,j,l=[],m=o(a);if(m===null)throw new k(a);j=m.options.middleware,d=h+g++,l=p(f,m.options.services);if(j)for(var n=0,s=j.length,t;n<s;n++)t=q(j[n]),t.options.services&&(l=p(l,t.options.services));return e=r(l),i[d]={creator:m.creator,instance:null,middleware:m.options.middleware||null,options:b,services:e},d},e.start=function(c){var d=n(c),f={},g;if(d!==null&&d.instance===null){f.app=e,f.options=d.options,f.services=d.services,g=new a.Sandbox(c,f);var h=function(){d.instance=d.creator(g);if(d.instance.create===b)throw new l("create");d.instance.create()};if(d.middleware){var i=0,j=d.middleware.length,k=function(){i+1>j?h():q(d.middleware[i++]).handleModule(g,k)};k()}else h();return c}return null},e.stop=function(a){var c=n(a);if(c!==null&&c.instance!==null){if(c.instance.destroy===b)throw new l("destroy");return c.instance.destroy(),c.instance=null,a}return null},e.removeService=function(a){r(a,null)},e.setService=function(a,b){b&&r(a,b)},m(),e},a.App.WidgetNotFoundError=function(a){this.name="WidgetNotFoundError",this.message="Widget "+(a?""+a+" ":"")+"doesn't exist"},a.App.RequiredCreatorMethodError=function(){this.name="RequiredCreatorMethodError",this.message='Widgets creator functions are required to return both a "create" and "destroy" function.'},a.App.WidgetNotFoundError.prototype=new Error,a.App.RequiredCreatorMethodError.prototype=new Error})(c),function(a){a.Messenger=function(){var a=this,c={},d,e,f,g,h,i;a.publish=function(a,d,e){var f,g;if(c[a]){thisMessage=d!==b?d:[],g=c[a];for(var h=0,i=g.length;h<i;h++)g[h].call(e||null,thisMessage)}},a.publishMany=function(b,c,d){for(var e=0,f=b.length;e<f;e++)a.publish(b[e],c,d)},a.subscribe=function(a,d){return c[a]===b&&(c[a]=[]),c[a].push(d),{channel:a,callback:d}},a.subscribeMany=function(b,c){var d=[];for(var e=0,f=b.length;e<f;e++)d.push(a.subscribe(b[e],c));return d},a.unsubscribe=function(a){var b=a.channel;if(b&&c[b]){var d=c[b];for(var e=0,f=d.length;e<f;e++)d[e]===a.callback&&d.splice(e,1)}},a.unsubscribeMany=function(b){for(var c=0,d=b.length;c<d;c++)a.unsubscribe(b[c])}},a.Messenger.Scoped=function(b,c){var d=a.Messenger,e=this,f=[],g,h,i,j;c||(c=new d),e.publish=function(a,d,e){c.publish(b+a,d,e)},e.subscribe=function(a,d){var e=c.subscribe(b+a,d);return f.push(e),e},e.unsubscribe=function(a){c.unsubscribe(a)},e.unsubscribeAll=function(){c.unsubscribeMany(f)}}}(c),function(a){a.Sandbox=function(b,c){c=c||{};var d=new a.Messenger.Scoped("/"+b,c.app||null),e=c.options||{},f=c.services||{};return d.getId=function(){return b},d.getOption=function(a){return e[a]},d.getService=function(a){return f[a]},d}}(c),function(a){a.SimpleCache=function(a){var c={},d=function(a,e){var f=null;if(e!==b)f=c[a]=e;else{if(Object.prototype.toString.call(a)==="[object String]")return c[a];if(Object.prototype.toString.call(a)==="[object Array]"){f={};for(var g=0,h=a.length;g<h;g++)f[a[g]]=d(a[g])}}return f};for(var e in a)a.hasOwnProperty(e)&&d(e,a[e]);return d}}(c),function(a){a.Widget=function(a,c,d){this.name=a,d===b?(this.creator=c,this.options={}):(this.options=c,this.creator=d)}}(c),a.Weld=c})(this);